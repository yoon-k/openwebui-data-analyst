<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Data Analyst - Upload CSV, Excel, JSON and get instant AI-powered insights, statistics, and beautiful visualizations. Supports 7 languages.">
    <meta name="keywords" content="AI, Data Analysis, CSV, Excel, JSON, Visualization, Chart, Statistics, Machine Learning, Analytics, OpenWebUI">
    <meta name="author" content="yoon-k">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="AI Data Analyst | OpenWebUI + LLM">
    <meta property="og:description" content="AI-powered data analysis with instant insights and beautiful visualizations">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <title>AI Data Analyst | OpenWebUI + LLM - Interactive Demo</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%F0%9F%93%8A%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --primary-rgb: 99, 102, 241;
            --secondary: #8b5cf6;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --bg-dark: #0a0a0f;
            --bg-darker: #050508;
            --bg-card: #12121a;
            --bg-input: #1a1a25;
            --bg-input-focus: #22222f;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2d2d3a;
            --border-light: #1f1f2a;
            --radius: 12px;
            --radius-sm: 6px;
            --radius-lg: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            --transition: 0.2s ease;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-darker); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 9999px; }
        ::selection { background: rgba(var(--primary-rgb), 0.3); }

        .header { background: rgba(10, 10, 15, 0.95); border-bottom: 1px solid var(--border); padding: 1rem 2rem; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(12px); }
        .header-content { max-width: 1600px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; }
        .logo { display: flex; align-items: center; gap: 0.875rem; }
        .logo-icon { font-size: 2rem; }
        .logo h1 { font-size: 1.375rem; font-weight: 700; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-subtitle { font-size: 0.75rem; color: var(--text-secondary); }

        .header-controls { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; }
        .api-connection { display: flex; align-items: center; gap: 0.5rem; background: var(--bg-input); padding: 0.5rem; border-radius: var(--radius); border: 1px solid var(--border-light); }
        .api-connection input { background: transparent; border: none; color: var(--text-primary); font-size: 0.8125rem; width: 200px; outline: none; }
        .api-connection input::placeholder { color: var(--text-muted); }
        .connect-btn { padding: 0.375rem 0.75rem; background: var(--primary); color: white; border: none; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: 500; cursor: pointer; transition: all var(--transition); }
        .connect-btn:hover { background: var(--primary-dark); }
        .connect-btn.connected { background: var(--success); }
        .connect-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .connection-status { display: flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background: var(--bg-input); border-radius: 9999px; font-size: 0.75rem; border: 1px solid var(--border-light); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--warning); animation: pulse 2s infinite; }
        .status-dot.connected { background: var(--success); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .lang-selector { display: flex; gap: 0.25rem; background: var(--bg-input); padding: 0.25rem; border-radius: var(--radius); border: 1px solid var(--border-light); }
        .lang-btn { padding: 0.375rem 0.625rem; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: 500; transition: all var(--transition); }
        .lang-btn:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
        .lang-btn.active { background: var(--primary); color: white; }

        .main-container { max-width: 1600px; margin: 0 auto; padding: 1.5rem; display: grid; grid-template-columns: 300px 1fr; gap: 1.5rem; min-height: calc(100vh - 80px); }
        .sidebar { display: flex; flex-direction: column; gap: 1rem; }
        .panel { background: var(--bg-card); border-radius: var(--radius-lg); border: 1px solid var(--border); overflow: hidden; }
        .panel-header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .panel-title { font-size: 0.8125rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); }
        .panel-body { padding: 1.25rem; }

        .upload-area { border: 2px dashed var(--border); border-radius: var(--radius); padding: 2rem 1rem; text-align: center; cursor: pointer; transition: all var(--transition); }
        .upload-area:hover { border-color: var(--primary); background: rgba(var(--primary-rgb), 0.05); }
        .upload-area.dragover { border-color: var(--success); background: rgba(34, 197, 94, 0.1); }
        .upload-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }
        .upload-text { font-weight: 500; margin-bottom: 0.5rem; }
        .upload-subtext { font-size: 0.8125rem; color: var(--text-muted); }
        #fileInput { display: none; }

        .data-info { background: var(--bg-input); border-radius: var(--radius); padding: 1rem; margin-top: 1rem; }
        .data-info-row { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-light); }
        .data-info-row:last-child { border-bottom: none; }
        .data-info-label { color: var(--text-muted); font-size: 0.8125rem; }
        .data-info-value { font-weight: 500; font-size: 0.8125rem; }

        .columns-list { margin-top: 1rem; }
        .column-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.625rem 0.75rem; background: var(--bg-input); border-radius: var(--radius-sm); margin-bottom: 0.5rem; font-size: 0.8125rem; }
        .column-type { padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; }
        .column-type.number { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .column-type.text { background: rgba(59, 130, 246, 0.2); color: var(--info); }
        .column-type.date { background: rgba(168, 85, 247, 0.2); color: var(--secondary); }

        .main-content { display: flex; flex-direction: column; gap: 1rem; }
        .tabs { display: flex; gap: 0.25rem; background: var(--bg-input); padding: 0.25rem; border-radius: var(--radius); overflow-x: auto; }
        .tab { padding: 0.625rem 1rem; background: transparent; border: none; color: var(--text-secondary); cursor: pointer; border-radius: var(--radius-sm); font-size: 0.875rem; font-weight: 500; transition: all var(--transition); white-space: nowrap; }
        .tab:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
        .tab.active { background: var(--bg-card); color: var(--text-primary); box-shadow: var(--shadow); }

        .content-area { flex: 1; background: var(--bg-card); border-radius: var(--radius-lg); border: 1px solid var(--border); padding: 1.5rem; min-height: 500px; }

        .data-table-container { overflow-x: auto; max-height: 400px; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.8125rem; }
        .data-table th, .data-table td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border-light); }
        .data-table th { background: var(--bg-input); font-weight: 600; color: var(--text-secondary); position: sticky; top: 0; }
        .data-table tr:hover { background: rgba(var(--primary-rgb), 0.05); }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .stat-card { background: var(--bg-input); border-radius: var(--radius); padding: 1.25rem; }
        .stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
        .stat-sublabel { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem; }

        .chart-container { height: 350px; display: flex; align-items: flex-end; gap: 1rem; padding: 1rem 0; }
        .chart-bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
        .chart-bar { width: 100%; max-width: 60px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: var(--radius-sm) var(--radius-sm) 0 0; transition: height 0.5s ease; }
        .chart-label { font-size: 0.75rem; color: var(--text-muted); text-align: center; }
        .chart-value { font-size: 0.8125rem; font-weight: 600; color: var(--text-primary); }

        .chart-controls { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .chart-type-btn { padding: 0.5rem 1rem; background: var(--bg-input); border: 1px solid var(--border); color: var(--text-secondary); border-radius: var(--radius-sm); cursor: pointer; font-size: 0.8125rem; transition: all var(--transition); }
        .chart-type-btn:hover { border-color: var(--primary); color: var(--text-primary); }
        .chart-type-btn.active { background: var(--primary); border-color: var(--primary); color: white; }

        .insights-list { display: flex; flex-direction: column; gap: 1rem; }
        .insight-card { background: var(--bg-input); border-radius: var(--radius); padding: 1.25rem; border-left: 3px solid var(--primary); }
        .insight-title { font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .insight-content { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; }

        .chat-container { display: flex; flex-direction: column; height: 100%; }
        .chat-messages { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; padding: 0.5rem 0; max-height: 400px; }
        .message { max-width: 85%; padding: 1rem 1.25rem; border-radius: var(--radius-lg); font-size: 0.9rem; line-height: 1.6; }
        .message.user { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; align-self: flex-end; border-bottom-right-radius: var(--radius-sm); }
        .message.assistant { background: var(--bg-input); align-self: flex-start; border-bottom-left-radius: var(--radius-sm); border: 1px solid var(--border-light); }
        .chat-input-container { display: flex; gap: 0.75rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-light); }
        .chat-input { flex: 1; padding: 0.75rem 1rem; background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-primary); font-size: 0.875rem; outline: none; }
        .chat-input:focus { border-color: var(--primary); }
        .chat-input::placeholder { color: var(--text-muted); }

        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: var(--radius); font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-input); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg-input-focus); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.8125rem; }

        .empty-state { text-align: center; padding: 4rem 2rem; color: var(--text-secondary); }
        .empty-state-icon { font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.4; }
        .empty-state h3 { font-size: 1.25rem; color: var(--text-primary); margin-bottom: 0.5rem; }
        .empty-state p { color: var(--text-muted); }

        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; gap: 1rem; }
        .spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .notification { position: fixed; bottom: 2rem; right: 2rem; padding: 1rem 1.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-lg); z-index: 400; display: flex; align-items: center; gap: 0.75rem; animation: slideIn 0.3s ease; max-width: 400px; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        .notification.success { border-color: var(--success); }
        .notification.error { border-color: var(--error); }
        .notification-message { flex: 1; font-size: 0.875rem; }

        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; }
            .sidebar { flex-direction: row; flex-wrap: wrap; }
            .sidebar > .panel { flex: 1; min-width: 280px; }
        }
        @media (max-width: 768px) {
            html { font-size: 14px; }
            .header { padding: 1rem; }
            .header-content { flex-direction: column; }
            .header-controls { flex-direction: column; width: 100%; }
            .api-connection { width: 100%; }
            .api-connection input { flex: 1; }
            .main-container { padding: 1rem; gap: 1rem; }
            .tabs { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üìä</span>
                <div>
                    <h1 id="title">AI Data Analyst</h1>
                    <p id="subtitle" class="logo-subtitle">Interactive Data Analysis Demo</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="api-connection">
                    <input type="text" id="apiUrl" placeholder="http://localhost:5000">
                    <button class="connect-btn" id="connectBtn" onclick="connectToAPI()">Connect</button>
                </div>
                <div class="connection-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">Simulation Mode</span>
                </div>
                <div class="lang-selector">
                    <button class="lang-btn active" data-lang="en" onclick="setLanguage('en')">EN</button>
                    <button class="lang-btn" data-lang="ko" onclick="setLanguage('ko')">KO</button>
                    <button class="lang-btn" data-lang="ja" onclick="setLanguage('ja')">JA</button>
                    <button class="lang-btn" data-lang="zh" onclick="setLanguage('zh')">ZH</button>
                    <button class="lang-btn" data-lang="es" onclick="setLanguage('es')">ES</button>
                    <button class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">FR</button>
                    <button class="lang-btn" data-lang="de" onclick="setLanguage('de')">DE</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-container">
        <div class="sidebar">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title" id="uploadPanelTitle">DATA SOURCE</span>
                </div>
                <div class="panel-body">
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text" id="uploadText">Drop your file here</div>
                        <div class="upload-subtext" id="uploadSubtext">CSV, Excel, JSON (max 16MB)</div>
                    </div>
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.json" onchange="handleFileUpload(event)">
                    <div id="dataInfo" style="display: none;"></div>
                    <div class="columns-list" id="columnsList"></div>
                </div>
            </div>
            <div class="panel" style="flex:1;">
                <div class="panel-header">
                    <span class="panel-title" id="sampleDataTitle">SAMPLE DATA</span>
                </div>
                <div class="panel-body">
                    <button class="btn btn-secondary btn-sm" onclick="loadSampleData('sales')" style="width:100%; margin-bottom:0.5rem;">
                        üí∞ <span id="sampleSales">Sales Data</span>
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="loadSampleData('weather')" style="width:100%; margin-bottom:0.5rem;">
                        üå§Ô∏è <span id="sampleWeather">Weather Data</span>
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="loadSampleData('users')" style="width:100%;">
                        üë• <span id="sampleUsers">User Analytics</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" data-tab="data" id="tabData" onclick="showTab('data')">Data</button>
                <button class="tab" data-tab="stats" id="tabStats" onclick="showTab('stats')">Statistics</button>
                <button class="tab" data-tab="chart" id="tabChart" onclick="showTab('chart')">Chart</button>
                <button class="tab" data-tab="insights" id="tabInsights" onclick="showTab('insights')">Insights</button>
                <button class="tab" data-tab="chat" id="tabChat" onclick="showTab('chat')">Chat</button>
            </div>
            <div class="content-area" id="contentArea">
                <div class="empty-state">
                    <div class="empty-state-icon">üìä</div>
                    <h3 id="emptyTitle">No Data Loaded</h3>
                    <p id="emptyDesc">Upload a file or select sample data to get started</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const i18n = {
            en: {
                title: "AI Data Analyst",
                subtitle: "Interactive Data Analysis Demo",
                connect: "Connect",
                disconnect: "Disconnect",
                connected: "Connected to API",
                simulation: "Simulation Mode",
                uploadPanelTitle: "DATA SOURCE",
                uploadText: "Drop your file here",
                uploadSubtext: "CSV, Excel, JSON (max 16MB)",
                sampleDataTitle: "SAMPLE DATA",
                sampleSales: "Sales Data",
                sampleWeather: "Weather Data",
                sampleUsers: "User Analytics",
                tabData: "Data",
                tabStats: "Statistics",
                tabChart: "Chart",
                tabInsights: "Insights",
                tabChat: "Chat",
                emptyTitle: "No Data Loaded",
                emptyDesc: "Upload a file or select sample data to get started",
                loading: "Loading...",
                rows: "Rows",
                columns: "Columns",
                fileLoaded: "File loaded successfully",
                chartBar: "Bar",
                chartLine: "Line",
                chartPie: "Pie",
                chartScatter: "Scatter",
                generateInsights: "Generate Insights",
                generating: "Generating...",
                chatPlaceholder: "Ask about your data...",
                send: "Send",
                mean: "Mean",
                median: "Median",
                stdDev: "Std Dev",
                min: "Min",
                max: "Max",
                count: "Count"
            },
            ko: {
                title: "AI Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä",
                subtitle: "Ïù∏ÌÑ∞ÎûôÌã∞Î∏å Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Îç∞Î™®",
                connect: "Ïó∞Í≤∞",
                disconnect: "Ïó∞Í≤∞Ìï¥Ï†ú",
                connected: "API Ïó∞Í≤∞Îê®",
                simulation: "ÏãúÎÆ¨Î†àÏù¥ÏÖò Î™®Îìú",
                uploadPanelTitle: "Îç∞Ïù¥ÌÑ∞ ÏÜåÏä§",
                uploadText: "ÌååÏùºÏùÑ Ïó¨Í∏∞Ïóê ÎÜìÏúºÏÑ∏Ïöî",
                uploadSubtext: "CSV, Excel, JSON (ÏµúÎåÄ 16MB)",
                sampleDataTitle: "ÏÉòÌîå Îç∞Ïù¥ÌÑ∞",
                sampleSales: "ÌåêÎß§ Îç∞Ïù¥ÌÑ∞",
                sampleWeather: "ÎÇ†Ïî® Îç∞Ïù¥ÌÑ∞",
                sampleUsers: "ÏÇ¨Ïö©Ïûê Î∂ÑÏÑù",
                tabData: "Îç∞Ïù¥ÌÑ∞",
                tabStats: "ÌÜµÍ≥Ñ",
                tabChart: "Ï∞®Ìä∏",
                tabInsights: "Ïù∏ÏÇ¨Ïù¥Ìä∏",
                tabChat: "Ï±ÑÌåÖ",
                emptyTitle: "Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå",
                emptyDesc: "ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî",
                loading: "Î°úÎî© Ï§ë...",
                rows: "Ìñâ",
                columns: "Ïó¥",
                fileLoaded: "ÌååÏùºÏù¥ Î°úÎìúÎêòÏóàÏäµÎãàÎã§",
                chartBar: "ÎßâÎåÄ",
                chartLine: "ÏÑ†",
                chartPie: "ÌååÏù¥",
                chartScatter: "ÏÇ∞Ï†êÎèÑ",
                generateInsights: "Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏÉùÏÑ±",
                generating: "ÏÉùÏÑ± Ï§ë...",
                chatPlaceholder: "Îç∞Ïù¥ÌÑ∞Ïóê ÎåÄÌï¥ ÏßàÎ¨∏ÌïòÏÑ∏Ïöî...",
                send: "Ï†ÑÏÜ°",
                mean: "ÌèâÍ∑†",
                median: "Ï§ëÏïôÍ∞í",
                stdDev: "ÌëúÏ§ÄÌé∏Ï∞®",
                min: "ÏµúÏÜå",
                max: "ÏµúÎåÄ",
                count: "Í∞úÏàò"
            },
            ja: {
                title: "AI „Éá„Éº„Çø„Ç¢„Éä„É™„Çπ„Éà",
                subtitle: "„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Éá„Éº„ÇøÂàÜÊûê„Éá„É¢",
                connect: "Êé•Á∂ö",
                disconnect: "ÂàáÊñ≠",
                connected: "APIÊé•Á∂öÊ∏à„Åø",
                simulation: "„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„É¢„Éº„Éâ",
                uploadPanelTitle: "„Éá„Éº„Çø„ÇΩ„Éº„Çπ",
                uploadText: "„Åì„Åì„Å´„Éï„Ç°„Ç§„É´„Çí„Éâ„É≠„ÉÉ„Éó",
                uploadSubtext: "CSV, Excel, JSON (ÊúÄÂ§ß16MB)",
                sampleDataTitle: "„Çµ„É≥„Éó„É´„Éá„Éº„Çø",
                sampleSales: "Â£≤‰∏ä„Éá„Éº„Çø",
                sampleWeather: "Â§©Ê∞ó„Éá„Éº„Çø",
                sampleUsers: "„É¶„Éº„Ç∂„ÉºÂàÜÊûê",
                tabData: "„Éá„Éº„Çø",
                tabStats: "Áµ±Ë®à",
                tabChart: "„ÉÅ„É£„Éº„Éà",
                tabInsights: "„Ç§„É≥„Çµ„Ç§„Éà",
                tabChat: "„ÉÅ„É£„ÉÉ„Éà",
                emptyTitle: "„Éá„Éº„Çø„Å™„Åó",
                emptyDesc: "„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Åã„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÈÅ∏Êäû",
                loading: "Ë™≠„ÅøËæº„Åø‰∏≠...",
                rows: "Ë°å",
                columns: "Âàó",
                fileLoaded: "„Éï„Ç°„Ç§„É´„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü",
                chartBar: "Ê£í",
                chartLine: "Á∑ö",
                chartPie: "ÂÜÜ",
                chartScatter: "Êï£Â∏É",
                generateInsights: "„Ç§„É≥„Çµ„Ç§„ÉàÁîüÊàê",
                generating: "ÁîüÊàê‰∏≠...",
                chatPlaceholder: "„Éá„Éº„Çø„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè...",
                send: "ÈÄÅ‰ø°",
                mean: "Âπ≥Âùá",
                median: "‰∏≠Â§ÆÂÄ§",
                stdDev: "Ê®ôÊ∫ñÂÅèÂ∑Æ",
                min: "ÊúÄÂ∞è",
                max: "ÊúÄÂ§ß",
                count: "ÂÄãÊï∞"
            },
            zh: {
                title: "AI Êï∞ÊçÆÂàÜÊûêÂ∏à",
                subtitle: "‰∫§‰∫íÂºèÊï∞ÊçÆÂàÜÊûêÊºîÁ§∫",
                connect: "ËøûÊé•",
                disconnect: "Êñ≠ÂºÄ",
                connected: "APIÂ∑≤ËøûÊé•",
                simulation: "Ê®°ÊãüÊ®°Âºè",
                uploadPanelTitle: "Êï∞ÊçÆÊ∫ê",
                uploadText: "Â∞ÜÊñá‰ª∂ÊãñÊîæÂà∞ËøôÈáå",
                uploadSubtext: "CSV, Excel, JSON (ÊúÄÂ§ß16MB)",
                sampleDataTitle: "Á§∫‰æãÊï∞ÊçÆ",
                sampleSales: "ÈîÄÂîÆÊï∞ÊçÆ",
                sampleWeather: "Â§©Ê∞îÊï∞ÊçÆ",
                sampleUsers: "Áî®Êà∑ÂàÜÊûê",
                tabData: "Êï∞ÊçÆ",
                tabStats: "ÁªüËÆ°",
                tabChart: "ÂõæË°®",
                tabInsights: "Ê¥ûÂØü",
                tabChat: "ËÅäÂ§©",
                emptyTitle: "Ê≤°ÊúâÊï∞ÊçÆ",
                emptyDesc: "‰∏ä‰º†Êñá‰ª∂ÊàñÈÄâÊã©Á§∫‰æãÊï∞ÊçÆ",
                loading: "Âä†ËΩΩ‰∏≠...",
                rows: "Ë°å",
                columns: "Âàó",
                fileLoaded: "Êñá‰ª∂Âä†ËΩΩÊàêÂäü",
                chartBar: "Êù°ÂΩ¢",
                chartLine: "ÊäòÁ∫ø",
                chartPie: "È•ºÂõæ",
                chartScatter: "Êï£ÁÇπ",
                generateInsights: "ÁîüÊàêÊ¥ûÂØü",
                generating: "ÁîüÊàê‰∏≠...",
                chatPlaceholder: "ËØ¢ÈóÆÊÇ®ÁöÑÊï∞ÊçÆ...",
                send: "ÂèëÈÄÅ",
                mean: "ÂùáÂÄº",
                median: "‰∏≠‰ΩçÊï∞",
                stdDev: "Ê†áÂáÜÂ∑Æ",
                min: "ÊúÄÂ∞è",
                max: "ÊúÄÂ§ß",
                count: "Êï∞Èáè"
            },
            es: {
                title: "Analista de Datos IA",
                subtitle: "Demo de Analisis de Datos Interactivo",
                connect: "Conectar",
                disconnect: "Desconectar",
                connected: "API Conectada",
                simulation: "Modo Simulacion",
                uploadPanelTitle: "FUENTE DE DATOS",
                uploadText: "Suelta tu archivo aqui",
                uploadSubtext: "CSV, Excel, JSON (max 16MB)",
                sampleDataTitle: "DATOS DE MUESTRA",
                sampleSales: "Datos de Ventas",
                sampleWeather: "Datos del Clima",
                sampleUsers: "Analisis de Usuarios",
                tabData: "Datos",
                tabStats: "Estadisticas",
                tabChart: "Grafico",
                tabInsights: "Insights",
                tabChat: "Chat",
                emptyTitle: "Sin Datos",
                emptyDesc: "Sube un archivo o selecciona datos de muestra",
                loading: "Cargando...",
                rows: "Filas",
                columns: "Columnas",
                fileLoaded: "Archivo cargado exitosamente",
                chartBar: "Barras",
                chartLine: "Linea",
                chartPie: "Circular",
                chartScatter: "Dispersion",
                generateInsights: "Generar Insights",
                generating: "Generando...",
                chatPlaceholder: "Pregunta sobre tus datos...",
                send: "Enviar",
                mean: "Media",
                median: "Mediana",
                stdDev: "Desv Est",
                min: "Min",
                max: "Max",
                count: "Cantidad"
            },
            fr: {
                title: "Analyste de Donnees IA",
                subtitle: "Demo d'Analyse de Donnees Interactive",
                connect: "Connecter",
                disconnect: "Deconnecter",
                connected: "API Connectee",
                simulation: "Mode Simulation",
                uploadPanelTitle: "SOURCE DE DONNEES",
                uploadText: "Deposez votre fichier ici",
                uploadSubtext: "CSV, Excel, JSON (max 16MB)",
                sampleDataTitle: "DONNEES EXEMPLES",
                sampleSales: "Donnees de Ventes",
                sampleWeather: "Donnees Meteo",
                sampleUsers: "Analyse Utilisateurs",
                tabData: "Donnees",
                tabStats: "Statistiques",
                tabChart: "Graphique",
                tabInsights: "Insights",
                tabChat: "Chat",
                emptyTitle: "Aucune Donnee",
                emptyDesc: "Telechargez un fichier ou selectionnez des donnees exemples",
                loading: "Chargement...",
                rows: "Lignes",
                columns: "Colonnes",
                fileLoaded: "Fichier charge avec succes",
                chartBar: "Barres",
                chartLine: "Ligne",
                chartPie: "Camembert",
                chartScatter: "Dispersion",
                generateInsights: "Generer des Insights",
                generating: "Generation...",
                chatPlaceholder: "Posez des questions sur vos donnees...",
                send: "Envoyer",
                mean: "Moyenne",
                median: "Mediane",
                stdDev: "Ecart Type",
                min: "Min",
                max: "Max",
                count: "Nombre"
            },
            de: {
                title: "KI-Datenanalyst",
                subtitle: "Interaktive Datenanalyse-Demo",
                connect: "Verbinden",
                disconnect: "Trennen",
                connected: "API Verbunden",
                simulation: "Simulationsmodus",
                uploadPanelTitle: "DATENQUELLE",
                uploadText: "Datei hier ablegen",
                uploadSubtext: "CSV, Excel, JSON (max 16MB)",
                sampleDataTitle: "BEISPIELDATEN",
                sampleSales: "Verkaufsdaten",
                sampleWeather: "Wetterdaten",
                sampleUsers: "Nutzeranalyse",
                tabData: "Daten",
                tabStats: "Statistik",
                tabChart: "Diagramm",
                tabInsights: "Erkenntnisse",
                tabChat: "Chat",
                emptyTitle: "Keine Daten",
                emptyDesc: "Laden Sie eine Datei hoch oder wahlen Sie Beispieldaten",
                loading: "Laden...",
                rows: "Zeilen",
                columns: "Spalten",
                fileLoaded: "Datei erfolgreich geladen",
                chartBar: "Balken",
                chartLine: "Linie",
                chartPie: "Kreis",
                chartScatter: "Streuung",
                generateInsights: "Erkenntnisse generieren",
                generating: "Generiere...",
                chatPlaceholder: "Fragen Sie zu Ihren Daten...",
                send: "Senden",
                mean: "Mittelwert",
                median: "Median",
                stdDev: "Standardabw",
                min: "Min",
                max: "Max",
                count: "Anzahl"
            }
        };

        let currentLang = 'en';
        let currentTab = 'data';
        let isConnected = false;
        let apiBaseUrl = '';
        let currentData = null;
        let chatMessages = [];
        let chatHistory = [];

        const sampleDatasets = {
            sales: {
                columns: ['month', 'revenue', 'expenses', 'profit', 'units_sold', 'region'],
                types: { month: 'text', revenue: 'number', expenses: 'number', profit: 'number', units_sold: 'number', region: 'text' },
                data: [
                    { month: 'Jan', revenue: 45000, expenses: 32000, profit: 13000, units_sold: 450, region: 'North' },
                    { month: 'Feb', revenue: 52000, expenses: 35000, profit: 17000, units_sold: 520, region: 'South' },
                    { month: 'Mar', revenue: 48000, expenses: 30000, profit: 18000, units_sold: 480, region: 'East' },
                    { month: 'Apr', revenue: 61000, expenses: 38000, profit: 23000, units_sold: 610, region: 'West' },
                    { month: 'May', revenue: 55000, expenses: 34000, profit: 21000, units_sold: 550, region: 'North' },
                    { month: 'Jun', revenue: 67000, expenses: 42000, profit: 25000, units_sold: 670, region: 'South' },
                    { month: 'Jul', revenue: 72000, expenses: 45000, profit: 27000, units_sold: 720, region: 'East' },
                    { month: 'Aug', revenue: 68000, expenses: 40000, profit: 28000, units_sold: 680, region: 'West' }
                ]
            },
            weather: {
                columns: ['city', 'temperature', 'humidity', 'wind_speed', 'condition', 'uv_index'],
                types: { city: 'text', temperature: 'number', humidity: 'number', wind_speed: 'number', condition: 'text', uv_index: 'number' },
                data: [
                    { city: 'Seoul', temperature: 22, humidity: 65, wind_speed: 12, condition: 'Sunny', uv_index: 7 },
                    { city: 'Tokyo', temperature: 25, humidity: 70, wind_speed: 8, condition: 'Cloudy', uv_index: 5 },
                    { city: 'New York', temperature: 18, humidity: 55, wind_speed: 15, condition: 'Rainy', uv_index: 3 },
                    { city: 'London', temperature: 15, humidity: 80, wind_speed: 20, condition: 'Foggy', uv_index: 2 },
                    { city: 'Paris', temperature: 20, humidity: 60, wind_speed: 10, condition: 'Sunny', uv_index: 6 },
                    { city: 'Sydney', temperature: 28, humidity: 45, wind_speed: 18, condition: 'Sunny', uv_index: 9 }
                ]
            },
            users: {
                columns: ['user_id', 'sessions', 'page_views', 'bounce_rate', 'avg_duration', 'source'],
                types: { user_id: 'text', sessions: 'number', page_views: 'number', bounce_rate: 'number', avg_duration: 'number', source: 'text' },
                data: [
                    { user_id: 'U001', sessions: 15, page_views: 45, bounce_rate: 32, avg_duration: 180, source: 'Organic' },
                    { user_id: 'U002', sessions: 8, page_views: 24, bounce_rate: 45, avg_duration: 120, source: 'Social' },
                    { user_id: 'U003', sessions: 22, page_views: 88, bounce_rate: 18, avg_duration: 300, source: 'Direct' },
                    { user_id: 'U004', sessions: 5, page_views: 12, bounce_rate: 65, avg_duration: 60, source: 'Referral' },
                    { user_id: 'U005', sessions: 18, page_views: 54, bounce_rate: 25, avg_duration: 240, source: 'Paid' },
                    { user_id: 'U006', sessions: 12, page_views: 36, bounce_rate: 38, avg_duration: 150, source: 'Organic' }
                ]
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('data-analyst-lang') || 'en';
            const savedApi = localStorage.getItem('data-analyst-api');

            if (savedApi) {
                document.getElementById('apiUrl').value = savedApi;
                checkConnection(savedApi);
            }

            setLanguage(savedLang);
            setupDragDrop();
        });

        function t(key) {
            return i18n[currentLang]?.[key] || key;
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('data-analyst-lang', lang);
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            updateUI();
        }

        function updateUI() {
            document.getElementById('title').textContent = t('title');
            document.getElementById('subtitle').textContent = t('subtitle');
            document.getElementById('uploadPanelTitle').textContent = t('uploadPanelTitle');
            document.getElementById('uploadText').textContent = t('uploadText');
            document.getElementById('uploadSubtext').textContent = t('uploadSubtext');
            document.getElementById('sampleDataTitle').textContent = t('sampleDataTitle');
            document.getElementById('sampleSales').textContent = t('sampleSales');
            document.getElementById('sampleWeather').textContent = t('sampleWeather');
            document.getElementById('sampleUsers').textContent = t('sampleUsers');
            document.getElementById('tabData').textContent = t('tabData');
            document.getElementById('tabStats').textContent = t('tabStats');
            document.getElementById('tabChart').textContent = t('tabChart');
            document.getElementById('tabInsights').textContent = t('tabInsights');
            document.getElementById('tabChat').textContent = t('tabChat');
            document.getElementById('emptyTitle').textContent = t('emptyTitle');
            document.getElementById('emptyDesc').textContent = t('emptyDesc');
            document.getElementById('connectBtn').textContent = isConnected ? t('disconnect') : t('connect');
            document.getElementById('statusText').textContent = isConnected ? t('connected') : t('simulation');
        }

        async function connectToAPI() {
            const url = document.getElementById('apiUrl').value.trim();

            if (isConnected) {
                isConnected = false;
                apiBaseUrl = '';
                localStorage.removeItem('data-analyst-api');
                updateConnectionStatus();
                return;
            }

            if (!url) {
                showNotification('Please enter API URL', 'error');
                return;
            }

            document.getElementById('connectBtn').disabled = true;

            try {
                const response = await fetch(`${url}/api/health`);
                if (response.ok) {
                    isConnected = true;
                    apiBaseUrl = url;
                    localStorage.setItem('data-analyst-api', url);
                    showNotification(t('connected'), 'success');
                } else {
                    throw new Error('Health check failed');
                }
            } catch (error) {
                showNotification(`Connection failed: ${error.message}`, 'error');
                isConnected = false;
            }

            document.getElementById('connectBtn').disabled = false;
            updateConnectionStatus();
        }

        async function checkConnection(url) {
            try {
                const response = await fetch(`${url}/api/health`);
                if (response.ok) {
                    isConnected = true;
                    apiBaseUrl = url;
                    updateConnectionStatus();
                }
            } catch (e) {}
        }

        function updateConnectionStatus() {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            const btn = document.getElementById('connectBtn');

            dot.classList.toggle('connected', isConnected);
            text.textContent = isConnected ? t('connected') : t('simulation');
            btn.textContent = isConnected ? t('disconnect') : t('connect');
            btn.classList.toggle('connected', isConnected);
        }

        function setupDragDrop() {
            const area = document.getElementById('uploadArea');

            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('dragover');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('dragover');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file) processFile(file);
            });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) processFile(file);
        }

        async function processFile(file) {
            showLoading();

            if (isConnected) {
                try {
                    const formData = new FormData();
                    formData.append('file', file);

                    const response = await fetch(`${apiBaseUrl}/api/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        currentData = result;
                        updateDataInfo();
                        showTab('data');
                        showNotification(t('fileLoaded'), 'success');
                    } else {
                        throw new Error('Upload failed');
                    }
                } catch (error) {
                    simulateFileLoad(file.name);
                }
            } else {
                simulateFileLoad(file.name);
            }
        }

        function simulateFileLoad(filename) {
            setTimeout(() => {
                currentData = sampleDatasets.sales;
                currentData.filename = filename;
                updateDataInfo();
                showTab('data');
                showNotification(t('fileLoaded'), 'success');
            }, 1000);
        }

        function loadSampleData(type) {
            currentData = { ...sampleDatasets[type], filename: `${type}_data.csv` };
            updateDataInfo();
            showTab('data');
            showNotification(t('fileLoaded'), 'success');
        }

        function updateDataInfo() {
            const infoDiv = document.getElementById('dataInfo');
            const columnsList = document.getElementById('columnsList');

            if (!currentData) {
                infoDiv.style.display = 'none';
                columnsList.innerHTML = '';
                return;
            }

            infoDiv.style.display = 'block';
            infoDiv.innerHTML = `
                <div class="data-info-row">
                    <span class="data-info-label">${t('rows')}</span>
                    <span class="data-info-value">${currentData.data.length}</span>
                </div>
                <div class="data-info-row">
                    <span class="data-info-label">${t('columns')}</span>
                    <span class="data-info-value">${currentData.columns.length}</span>
                </div>
            `;

            columnsList.innerHTML = currentData.columns.map(col => {
                const type = currentData.types[col] || 'text';
                return `
                    <div class="column-item">
                        <span class="column-type ${type}">${type.substring(0, 3).toUpperCase()}</span>
                        <span>${col}</span>
                    </div>
                `;
            }).join('');
        }

        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            renderCurrentTab();
        }

        function renderCurrentTab() {
            if (!currentData) {
                document.getElementById('contentArea').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3>${t('emptyTitle')}</h3>
                        <p>${t('emptyDesc')}</p>
                    </div>
                `;
                return;
            }

            switch (currentTab) {
                case 'data': renderDataTab(); break;
                case 'stats': renderStatsTab(); break;
                case 'chart': renderChartTab(); break;
                case 'insights': renderInsightsTab(); break;
                case 'chat': renderChatTab(); break;
            }
        }

        function renderDataTab() {
            const container = document.getElementById('contentArea');
            container.innerHTML = `
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                ${currentData.columns.map(col => `<th>${col}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${currentData.data.map(row => `
                                <tr>
                                    ${currentData.columns.map(col => `<td>${row[col]}</td>`).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderStatsTab() {
            const container = document.getElementById('contentArea');
            const numericColumns = currentData.columns.filter(col => currentData.types[col] === 'number');

            if (numericColumns.length === 0) {
                container.innerHTML = `<div class="empty-state"><h3>No numeric columns for statistics</h3></div>`;
                return;
            }

            const stats = numericColumns.map(col => {
                const values = currentData.data.map(row => row[col]).filter(v => typeof v === 'number');
                const sorted = [...values].sort((a, b) => a - b);
                const sum = values.reduce((a, b) => a + b, 0);
                const mean = sum / values.length;
                const median = sorted[Math.floor(sorted.length / 2)];
                const stdDev = Math.sqrt(values.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / values.length);

                return {
                    column: col,
                    count: values.length,
                    mean: mean.toFixed(2),
                    median: median,
                    stdDev: stdDev.toFixed(2),
                    min: Math.min(...values),
                    max: Math.max(...values)
                };
            });

            container.innerHTML = `
                <div class="stats-grid">
                    ${stats.map(s => `
                        <div class="stat-card">
                            <div class="stat-label">${s.column}</div>
                            <div class="stat-value">${s.mean}</div>
                            <div class="stat-sublabel">${t('mean')}</div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 2rem;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Column</th>
                                <th>${t('count')}</th>
                                <th>${t('mean')}</th>
                                <th>${t('median')}</th>
                                <th>${t('stdDev')}</th>
                                <th>${t('min')}</th>
                                <th>${t('max')}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${stats.map(s => `
                                <tr>
                                    <td><strong>${s.column}</strong></td>
                                    <td>${s.count}</td>
                                    <td>${s.mean}</td>
                                    <td>${s.median}</td>
                                    <td>${s.stdDev}</td>
                                    <td>${s.min}</td>
                                    <td>${s.max}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderChartTab() {
            const container = document.getElementById('contentArea');
            const numericColumns = currentData.columns.filter(col => currentData.types[col] === 'number');
            const textColumns = currentData.columns.filter(col => currentData.types[col] === 'text');

            if (numericColumns.length === 0) {
                container.innerHTML = `<div class="empty-state"><h3>No numeric columns for charts</h3></div>`;
                return;
            }

            const labelCol = textColumns[0] || currentData.columns[0];
            const valueCol = numericColumns[0];
            const maxValue = Math.max(...currentData.data.map(row => row[valueCol]));

            container.innerHTML = `
                <div class="chart-controls">
                    <button class="chart-type-btn active">üìä ${t('chartBar')}</button>
                    <button class="chart-type-btn">üìà ${t('chartLine')}</button>
                    <button class="chart-type-btn">ü•ß ${t('chartPie')}</button>
                    <button class="chart-type-btn">‚ö¨ ${t('chartScatter')}</button>
                </div>
                <h3 style="margin-bottom: 1rem;">${valueCol} by ${labelCol}</h3>
                <div class="chart-container">
                    ${currentData.data.map(row => {
                        const height = (row[valueCol] / maxValue) * 100;
                        return `
                            <div class="chart-bar-group">
                                <div class="chart-value">${row[valueCol].toLocaleString()}</div>
                                <div class="chart-bar" style="height: ${height}%"></div>
                                <div class="chart-label">${row[labelCol]}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        async function renderInsightsTab() {
            const container = document.getElementById('contentArea');

            if (isConnected) {
                container.innerHTML = `<div class="loading"><div class="spinner"></div><span>${t('generating')}</span></div>`;

                try {
                    const response = await fetch(`${apiBaseUrl}/api/insights?language=${currentLang}`);
                    if (response.ok) {
                        const data = await response.json();
                        renderInsightsContent(data.insights || generateSimulatedInsights());
                    } else {
                        throw new Error('Failed to get insights');
                    }
                } catch (error) {
                    renderInsightsContent(generateSimulatedInsights());
                }
            } else {
                renderInsightsContent(generateSimulatedInsights());
            }
        }

        function generateSimulatedInsights() {
            const numericColumns = currentData.columns.filter(col => currentData.types[col] === 'number');
            const insights = [];

            if (numericColumns.length > 0) {
                const col = numericColumns[0];
                const values = currentData.data.map(row => row[col]);
                const max = Math.max(...values);
                const min = Math.min(...values);
                const avg = values.reduce((a, b) => a + b, 0) / values.length;

                insights.push({
                    title: `üìà ${col} Analysis`,
                    content: `The ${col} ranges from ${min.toLocaleString()} to ${max.toLocaleString()} with an average of ${avg.toFixed(2).toLocaleString()}. This represents a ${((max - min) / avg * 100).toFixed(1)}% variance from the mean.`
                });

                insights.push({
                    title: `üéØ Key Finding`,
                    content: `The highest ${col} value (${max.toLocaleString()}) is ${((max / avg - 1) * 100).toFixed(1)}% above average, indicating a potential peak period or outlier worth investigating.`
                });
            }

            insights.push({
                title: `üìä Data Overview`,
                content: `This dataset contains ${currentData.data.length} records across ${currentData.columns.length} columns. The data appears to be ${currentData.data.length > 5 ? 'sufficient' : 'limited'} for basic analysis.`
            });

            insights.push({
                title: `üí° Recommendation`,
                content: `Consider segmenting the data by categorical columns for deeper insights. Cross-referencing numeric columns may reveal correlations.`
            });

            return insights;
        }

        function renderInsightsContent(insights) {
            const container = document.getElementById('contentArea');
            container.innerHTML = `
                <div class="insights-list">
                    ${insights.map(insight => `
                        <div class="insight-card">
                            <div class="insight-title">${insight.title}</div>
                            <div class="insight-content">${insight.content}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderChatTab() {
            const container = document.getElementById('contentArea');
            container.innerHTML = `
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        ${chatMessages.length === 0 ? `
                            <div class="empty-state" style="padding:2rem;">
                                <div class="empty-state-icon">üí¨</div>
                                <h3>Chat with your data</h3>
                                <p>${t('chatPlaceholder')}</p>
                            </div>
                        ` : chatMessages.map(m => `
                            <div class="message ${m.role}">${m.content}</div>
                        `).join('')}
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="${t('chatPlaceholder')}" onkeypress="if(event.key==='Enter')sendChatMessage()">
                        <button class="btn btn-primary" onclick="sendChatMessage()">${t('send')}</button>
                    </div>
                </div>
            `;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input?.value?.trim();

            if (!message) return;

            chatMessages.push({ role: 'user', content: message });
            chatHistory.push({ role: 'user', content: message });
            input.value = '';
            renderChatTab();

            if (isConnected) {
                try {
                    const response = await fetch(`${apiBaseUrl}/api/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: message,
                            history: chatHistory,
                            language: currentLang
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const reply = data.response || 'Response received';
                        chatMessages.push({ role: 'assistant', content: reply });
                        chatHistory.push({ role: 'assistant', content: reply });
                        renderChatTab();
                        scrollChatToBottom();
                    } else {
                        throw new Error('Chat failed');
                    }
                } catch (error) {
                    simulateChatResponse(message);
                }
            } else {
                setTimeout(() => simulateChatResponse(message), 1000);
            }
        }

        function simulateChatResponse(message) {
            const responses = {
                en: [
                    "Based on the data, I can see some interesting patterns. The numeric columns show varying distributions.",
                    "Looking at your dataset, the key metrics appear to be trending positively.",
                    "I'd recommend focusing on the columns with the highest variance for deeper analysis.",
                    "The data suggests there might be some seasonal patterns worth investigating.",
                    "For a more detailed analysis, try filtering by the categorical columns."
                ],
                ko: [
                    "Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïú Í≤∞Í≥º, Ìù•ÎØ∏Î°úÏö¥ Ìå®ÌÑ¥Ïù¥ ÏûàÏäµÎãàÎã§. Ïà´Ïûê Ïª¨ÎüºÎì§ÏùÄ Îã§ÏñëÌïú Î∂ÑÌè¨Î•º Î≥¥ÏûÖÎãàÎã§.",
                    "Îç∞Ïù¥ÌÑ∞ÏÖãÏùÑ Î≥¥Î©¥ Ï£ºÏöî ÏßÄÌëúÍ∞Ä Í∏çÏ†ïÏ†ÅÏù∏ Ï∂îÏÑ∏Î•º Î≥¥ÏûÖÎãàÎã§.",
                    "Î∂ÑÏÇ∞Ïù¥ Í∞ÄÏû• ÌÅ∞ Ïª¨ÎüºÏóê ÏßëÏ§ëÌïòÏó¨ Ïã¨Ï∏µ Î∂ÑÏÑùÌïòÎäî Í≤ÉÏùÑ Ï∂îÏ≤úÎìúÎ¶ΩÎãàÎã§.",
                    "Îç∞Ïù¥ÌÑ∞Îäî Ï°∞ÏÇ¨Ìï† Í∞ÄÏπòÍ∞Ä ÏûàÎäî Í≥ÑÏ†àÏ†Å Ìå®ÌÑ¥Ïù¥ ÏûàÏùÑ Ïàò ÏûàÏùåÏùÑ ÏãúÏÇ¨Ìï©ÎãàÎã§.",
                    "Îçî ÏûêÏÑ∏Ìïú Î∂ÑÏÑùÏùÑ ÏúÑÌï¥ Î≤îÏ£ºÌòï Ïó¥Î°ú ÌïÑÌÑ∞ÎßÅÌï¥ Î≥¥ÏÑ∏Ïöî."
                ]
            };

            const langResponses = responses[currentLang] || responses.en;
            const reply = langResponses[Math.floor(Math.random() * langResponses.length)];

            chatMessages.push({ role: 'assistant', content: reply });
            chatHistory.push({ role: 'assistant', content: reply });
            renderChatTab();
            scrollChatToBottom();
        }

        function scrollChatToBottom() {
            const container = document.getElementById('chatMessages');
            if (container) container.scrollTop = container.scrollHeight;
        }

        function showLoading() {
            document.getElementById('contentArea').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span>${t('loading')}</span>
                </div>
            `;
        }

        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<span class="notification-message">${message}</span>`;
            document.body.appendChild(notification);

            setTimeout(() => notification.remove(), 3000);
        }
    </script>
</body>
</html>
